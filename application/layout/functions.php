<?php function getattendance($btcid,$canid){	//all holidays	$holiday=array();	$holi_qry = "SELECT * FROM holidays WHERE batch_id='".$_REQUEST['bchid']."'";    $holi_Exe = mysql_query($holi_qry);    while($holi_arr = mysql_fetch_array($holi_Exe))    {    	array_push($holiday, $holi_arr['start_event']);    }	//for candidates first array	$sql = "SELECT * FROM candidate_master WHERE batch_id='".$btcid."' AND candidate_id='".$canid."'";	$exe = mysql_query($sql);		while ($pattern = mysql_fetch_array($exe)) {				//batch planner for month second array		$sql ="SELECT * FROM batch_planner WHERE batch_id='".$btcid."'";	    $res = mysql_query($sql);	    $arr = mysql_fetch_array($res);	    if($arr['start_date'] !="")	    {	      $startDate = $arr['start_date'];	      $endDate = $arr['end_date'];	      $startTime = $arr['start_time'];	      $endTime = $arr['end_time'];	      $totaldays = $arr['total_days'];	      //apsent		  $cand= "SELECT * FROM manage_attendance WHERE batch_id='".$btcid."' AND candidate_id='".$canid."'";		  $canExe = mysql_query($cand);		  $canarr = mysql_fetch_array($canExe);		  $can_per = $canarr['candidate_percentage']; 		  $total_prestn = round($totaldays*$can_per/100);		  $total_apsent = $totaldays-$total_prestn;	      $datestart = strtotime($startDate );//you can change it to your timestamp;		  $dateend = strtotime($endDate);//you can change it to your timestamp;		  $daystep = 86400;		  		  $ram = array(); 		  while ($total_apsent > 0) {		  	 $datebetween = abs(($dateend - $datestart) / $daystep);		  	 $randomday = rand(0, $datebetween);			  	 $dt = date("Y-m-d", $datestart + ($randomday * $daystep));			 $qry_holiday = "SELECT * FROM holidays WHERE batch_id='".$_REQUEST['bchid']."' AND start_event='".$dt."'";	         $Exe_holiday = mysql_query($qry_holiday);	         $arr_holiday = mysql_num_rows($Exe_holiday);	        	        if($arr_holiday==0){	        	if (!in_array($dt, $ram)) {				    array_push($ram, $dt);					$total_apsent--;    				}	        }		       		  }		  	//echo "<pre/>";	        //print_r($ram);		 	//print_r($holiday);	      $months = array(); $numbermonth = array(); $bt="";	      while (strtotime($startDate) <= strtotime($endDate)) 	      {  	          //$dat = date('M', strtotime($startDate))."-".date('Y', strtotime($startDate));	          $mon = date('m', strtotime($startDate));	          $monalfa = date('M', strtotime($startDate));	          $year = date('Y', strtotime($startDate));	          $startDate = date('d M Y', strtotime($startDate.'+ 1 month'));	          //all dates and days	          $month = $mon;              $year = date('Y');              $tr="";              for($d=1; $d<=31; $d++)              {                	$time=mktime(12, 0, 0, $month, $d, $year);                   	$holiqry = "SELECT * FROM holidays WHERE batch_id='".$_REQUEST['bchid']."' AND start_event='".date('Y-m-d', $time)."'";	                $holiExe = mysql_query($holiqry);	                $holiarr = mysql_fetch_array($holiExe);	                if($holiarr['start_event'] == date('Y-m-d', $time)){$shift=$holiarr['title'];} else{$shift="IGN";}                  	if(date('m', $time)==$month)                             $dates=date('Y-m-d', $time);                  	  $days=date('D', $time);	                  // start time	                  $start_first = strtotime($startTime);	                  $start_second = strtotime('+40 minutes +30 seconds',$start_first);					  $randomStart = date("H:i:s", rand($start_first, $start_second));					  // end time	                  $end_first = strtotime($endTime);	                  $end_second = strtotime('-57 minutes -42 seconds',$end_first);					  $randomEnd = date("H:i:s", rand($end_first, $end_second));				 	//absent date					 if(in_array($dates, $ram)) {					   					      $arrPaperSection[$pattern['name']][$monalfa][$dates]['days'] = $days;		                  $arrPaperSection[$pattern['name']][$monalfa][$dates]['holidays'] = "Absent";		                  $arrPaperSection[$pattern['name']][$monalfa][$dates]['InTime'] = 0;		                  $arrPaperSection[$pattern['name']][$monalfa][$dates]['OutTime'] = 0;		                  $arrPaperSection[$pattern['name']][$monalfa][$dates]['TotalHours'] = 0;		                  $arrPaperSection[$pattern['name']][$monalfa][$dates]['Status'] = "A";		                  					}					else if(in_array($dates, $holiday))					{						  $arrPaperSection[$pattern['name']][$monalfa][$dates]['days'] = $days;		                  $arrPaperSection[$pattern['name']][$monalfa][$dates]['holidays'] = $shift;		                  $arrPaperSection[$pattern['name']][$monalfa][$dates]['InTime'] = 0;		                  $arrPaperSection[$pattern['name']][$monalfa][$dates]['OutTime'] = 0;		                  $arrPaperSection[$pattern['name']][$monalfa][$dates]['TotalHours'] = 0;		                  $arrPaperSection[$pattern['name']][$monalfa][$dates]['Status'] = "H";					}					else					{						  $arrPaperSection[$pattern['name']][$monalfa][$dates]['days'] = $days;		                  $arrPaperSection[$pattern['name']][$monalfa][$dates]['holidays'] = $shift;		                  $arrPaperSection[$pattern['name']][$monalfa][$dates]['InTime'] = $randomStart;		                  $arrPaperSection[$pattern['name']][$monalfa][$dates]['OutTime'] = $randomEnd;		                  $arrPaperSection[$pattern['name']][$monalfa][$dates]['TotalHours'] = $randomEnd-$randomStart;		                  $arrPaperSection[$pattern['name']][$monalfa][$dates]['Status'] = "P";		                  					}               		if($dates == date('Y-m-d', strtotime($endDate))) {break;}                }	      } 	    }	}		$arrTestTakerResult['nos_marks'] = $arrPaperSection;		return $arrTestTakerResult;	}?>